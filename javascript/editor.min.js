document.addEventListener("DOMContentLoaded",function(){document.execCommand("defaultParagraphSeparator",false,"p");const editors1=document.getElementsByClassName("editor input-text");const editors2=document.getElementsByClassName("editor checkbox");const editors3=document.getElementsByClassName("editor content-html");const editors4=document.getElementsByClassName("editor textarea");const editors5=document.getElementsByClassName("editor select");const saveAPIURL="/editor/api/save";function saveData(datatype,request,i){let xhr=new XMLHttpRequest;xhr.open("POST",saveAPIURL,true);xhr.setRequestHeader("Content-type","application/json; charset=UTF-8");xhr.send(request);xhr.onload=function(){if(xhr.status===200){const response=JSON.parse(xhr.response);if(response.changed){switch(datatype){case"input-text":responseProcessingInputType(i);break;case"checkbox":responseProcessingCheckBox(i);break;case"content-html":responseProcessingContentHTML(i);break;case"textarea":responseProcessingTextArea(i);break}}else{switch(response.error){case"wrong_connID":alert("Error: invalid database connection id!");break;case"wrong_key":alert("Error: wrong key!");break}}}}}function responseProcessingInputType(i){editors1[i].setAttribute("data-default",editors1[i].value)}function saveInputText(i){if(editors1[i].value!==editors1[i].getAttribute("data-default")){const request=JSON.stringify({"conn-id":parseInt(editors1[i].getAttribute("data-conn-id")),key:editors1[i].getAttribute("data-key"),value:editors1[i].value});saveData("input-text",request,i)}}for(let i=0;i<editors1.length;i++){editors1[i].addEventListener("focusout",()=>{saveInputText(i)});editors1[i].addEventListener("keypress",e=>{if(e.which===13){saveInputText(i)}})}function responseProcessingCheckBox(i){editors2[i].setAttribute("data-value",editors2[i].getAttribute("data-value")!=="true");if(editors2[i].getAttribute("data-value")==="true"){editors2[i].innerHTML="âœ”"}else{editors2[i].innerHTML=""}}function saveCheckBox(i){const request=JSON.stringify({"conn-id":parseInt(editors2[i].getAttribute("data-conn-id")),key:editors2[i].getAttribute("data-key")});saveData("checkbox",request,i)}for(let i=0;i<editors2.length;i++){editors2[i].addEventListener("click",()=>{saveCheckBox(i)})}for(let i=0;i<editors3.length;i++){editors3[i].setAttribute("data-default",editors3[i].innerHTML)}function responseProcessingContentHTML(i){editors3[i].setAttribute("data-default",editors3[i].innerHTML)}function saveContentHTML(i){if(editors3[i].innerHTML!==editors3[i].getAttribute("data-default")){const request=JSON.stringify({"conn-id":parseInt(editors3[i].getAttribute("data-conn-id")),key:editors3[i].getAttribute("data-key"),value:editors3[i].innerHTML});saveData("content-html",request,i)}}for(let i=0;i<editors3.length;i++){editors3[i].addEventListener("focusout",()=>{saveContentHTML(i)})}function responseProcessingTextArea(i){editors4[i].setAttribute("data-default",editors4[i].value)}function saveTextArea(i){if(editors4[i].value!==editors4[i].getAttribute("data-default")){const request=JSON.stringify({"conn-id":parseInt(editors4[i].getAttribute("data-conn-id")),key:editors4[i].getAttribute("data-key"),value:editors4[i].value});saveData("textarea",request,i)}}for(let i=0;i<editors4.length;i++){editors4[i].addEventListener("focusout",()=>{saveTextArea(i)})}function saveSelect(i){const request=JSON.stringify({"conn-id":parseInt(editors5[i].getAttribute("data-conn-id")),key:editors5[i].getAttribute("data-key"),value:editors5[i].value});saveData("select",request,i)}for(let i=0;i<editors5.length;i++){editors5[i].addEventListener("change",()=>{saveSelect(i)})}});